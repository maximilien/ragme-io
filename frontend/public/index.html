<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <title>ðŸ¤– RAGme.io Assistant</title>
    <script>
        // Debug script to check MCP Tools elements

    </script>

    <!-- Immediate redirect if on HTTPS -->
    <script>
        if (window.location.protocol === 'https:' && window.location.hostname === 'localhost') {
            window.location.replace('http://localhost:8020/');
        }
    </script>

    <!-- Load resources dynamically to force HTTP -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Create stylesheet links
            const styles = ['styles.css', 'all.min.css'];
            styles.forEach(function(href) {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'http://localhost:8020/' + href;
                document.head.appendChild(link);
            });

            // Create script tags
            const scripts = ['d3.v7.min.js', 'marked.min.js', 'purify.min.js'];
            let loadedScripts = 0;

            function loadNextScript() {
                if (loadedScripts < scripts.length) {
                    const script = document.createElement('script');
                    script.src = 'http://localhost:8020/' + scripts[loadedScripts];
                    script.onload = function() {
                        loadedScripts++;
                        loadNextScript();
                    };
                    script.onerror = function() {
                        console.error('Failed to load script:', scripts[loadedScripts]);
                        loadedScripts++;
                        loadNextScript();
                    };
                    document.head.appendChild(script);
                } else {
                    // Load socket.io and app.js last
                    const socketScript = document.createElement('script');
                    socketScript.src = 'http://localhost:8020/socket.io/socket.io.js';
                    socketScript.onload = function() {
                        const appScript = document.createElement('script');
                        appScript.src = 'http://localhost:8020/app.js?v=1.2';
                        document.head.appendChild(appScript);
                    };
                    document.head.appendChild(socketScript);
                }
            }

            loadNextScript();
        });
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Header with hamburger menu -->
        <header class="header">
            <div class="header-left">
                <button class="hamburger-menu" id="hamburgerMenu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="title">ðŸ¤– RAGme.io Assistant</h1>
            </div>
            <div class="header-center">
                <div class="vector-db-info" id="vectorDbInfo" style="display: none;">
                    <span class="vector-db-label">Vector DB:</span>
                    <span class="vector-db-type" id="vectorDbType">-</span>
                    <span class="vector-db-separator">|</span>
                    <span class="vector-db-label">Collections:</span>
                    <span class="vector-db-collection" id="vectorDbCollection">-</span>
                </div>
            </div>
            <div class="header-right">
                <div class="progress-indicator" id="progressIndicator">
                    <div class="progress-spinner"></div>
                    <span class="progress-text" id="progressText">Processing...</span>
                </div>
                <button class="add-content-btn" id="addContentBtn">
                    <i class="fas fa-plus"></i>
                    Add Content
                </button>

            </div>
        </header>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Chat history sidebar (20% width, collapsible) -->
            <div class="chat-history-sidebar" id="chatHistorySidebar">
                <div class="sidebar-header">
                    <h3>Chat History</h3>
                    <button class="new-chat-btn" id="newChatBtn" title="New chat">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="collapse-btn" id="collapseSidebar">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="chat-history-list" id="chatHistoryList">
                    <!-- Chat history items will be populated here -->
                </div>
            </div>

            <!-- Main chat area (middle section) -->
            <div class="chat-main-area">
                <!-- Restore sidebar button (hidden by default) -->
                <button class="restore-sidebar-btn" id="restoreSidebarBtn" style="display: none;">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <!-- Restore documents button (hidden by default) -->
                <button class="restore-docs-btn" id="restoreDocumentsBtn" style="display: none;">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be populated here -->
                </div>
                <div class="chat-input-container">
                                    <div class="chat-input-wrapper">
                    <button class="mcp-tools-btn" id="mcpToolsBtn" title="MCP Server Tools">
                        <i class="fas fa-toolbox"></i>
                    </button>
                    <button class="recent-prompts-btn" id="recentPromptsBtn" title="Recent prompts & ideas">
                        <i class="fas fa-history"></i>
                    </button>
                    <button class="microphone-btn" id="microphoneBtn" title="Voice input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <textarea
                        id="chatInput"
                        placeholder="Ask me about your documents or tell me URLs to RAG..."
                        rows="1"
                    ></textarea>
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                                    <div class="recent-prompts-backdrop" id="recentPromptsBackdrop"></div>
                <div class="recent-prompts-popup" id="recentPromptsPopup">
                    <div class="recent-prompts-header">
                        <div class="recent-prompts-title">Recent Prompts & Ideas</div>
                        <button class="recent-prompts-close" id="recentPromptsClose">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="recent-prompts-list" id="recentPromptsList">
                        <!-- Recent prompts will be populated here -->
                    </div>
                </div>

                <!-- MCP Tools Popup -->
                <div class="mcp-tools-backdrop" id="mcpToolsBackdrop"></div>
                <div class="mcp-tools-popup" id="mcpToolsPopup">
                    <div class="mcp-tools-header">
                        <div class="mcp-tools-title">MCP Server Tools</div>
                        <button class="mcp-tools-close" id="mcpToolsClose">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="mcp-tools-list" id="mcpToolsList">
                        <!-- MCP servers will be populated here -->
                    </div>
                </div>
                </div>
            </div>

            <!-- Resizable divider -->
            <div class="resize-divider" id="resizeDivider">
                <div class="resize-handle">
                    <i class="fas fa-grip-vertical"></i>
                </div>
            </div>

            <!-- Recent Documents sidebar (resizable) -->
            <div class="documents-sidebar" id="documentsSidebar">
                <div class="sidebar-header">
                    <div class="search-container">
                        <div class="search-input-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="documentSearchInput" class="search-input" placeholder="Search documents..." />
                            <button type="button" id="clearSearchBtn" class="clear-search-btn" title="Clear search" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="sidebar-header-actions">
                        <div class="filter-indicator" id="filterIndicator" title="Content type filter">
                            <i class="fas fa-file-alt" id="filterIcon"></i>
                        </div>
                        <div class="date-filter-indicator" id="dateFilterIndicator" title="Date filter">
                            <i class="fas fa-calendar-day" id="dateFilterIcon"></i>
                        </div>
                        <button class="document-settings-btn" id="documentSettingsBtn" title="Document listing settings">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                        <button class="refresh-btn" id="refreshDocuments" title="Refresh documents">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="collapse-btn" id="collapseDocuments">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="documents-content" id="documentsContent">
                    <!-- Documents visualization container -->
                    <div class="documents-visualization" id="documentsVisualization">
                        <div class="visualization-header">
                            <h4>Documents Overview</h4>
                            <div class="visualization-controls">
                                <select class="visualization-type-selector" id="visualizationTypeSelector">
                                    <option value="graph">Network Graph</option>
                                    <option value="bar">Bar Chart</option>
                                    <option value="pie">Pie Chart</option>
                                </select>
                                <button class="visualization-toggle-btn" id="visualizationToggleBtn" title="Toggle Documents Overview">
                                    <i class="fas fa-eye-slash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="visualization-content" id="visualizationContent">
                            <div class="visualization-placeholder">
                                <i class="fas fa-file-alt"></i>
                                <p>Documents Visualization</p>
                                <p class="visualization-description">
                                    This area displays your documents and their relationships using D3.js visualization.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Resize handle for visualization -->
                    <div class="visualization-resize-handle" id="visualizationResizeHandle">
                        <div class="resize-indicator">
                            <i class="fas fa-grip-lines"></i>
                        </div>
                    </div>

                    <!-- Documents list container -->
                    <div class="documents-list-container" id="documentsListContainer">
                        <!-- Document cards will be populated here -->
                    </div>

                    <!-- Pagination container -->
                    <div class="pagination-container" id="paginationContainer" style="display: none;">
                        <div class="pagination-controls" id="paginationControls" title="">
                            <button class="pagination-btn" id="paginationPrev" title="Previous page">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="pagination-pages" id="paginationPages">
                                <!-- Page numbers will be populated here -->
                            </div>
                            <button class="pagination-btn" id="paginationNext" title="Next page">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Document Settings Popup -->
                <div class="document-settings-backdrop" id="documentSettingsBackdrop"></div>
                <div class="document-settings-popup" id="documentSettingsPopup">
                    <div class="document-settings-header">
                        <div class="document-settings-title">Document Listing Settings</div>
                        <button class="document-settings-close" id="documentSettingsClose">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="document-settings-content">
                        <div class="settings-section">
                            <h4>Content Type Filter</h4>
                            <select class="content-filter-selector" id="contentFilterSelector" title="Filter by content type">
                                <option value="both">All</option>
                                <option value="documents">Documents</option>
                                <option value="images">Images</option>
                            </select>
                        </div>
                        <div class="settings-section">
                            <h4>Date Filter</h4>
                            <select class="date-filter-selector" id="dateFilterSelector" title="Filter documents by date">
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                                <option value="all">All</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hamburger menu dropdown OUTSIDE app-container -->
    <div class="menu-dropdown" id="menuDropdown">
        <div class="menu-item submenu-trigger" id="manageChatsTrigger">
            <i class="fas fa-comments"></i>
            Manage Chats
            <i class="fas fa-chevron-right submenu-arrow"></i>
        </div>
        <div class="submenu" id="manageChatsSubmenu">
            <div class="menu-item submenu-item" id="newChat">
                <i class="fas fa-plus"></i>
                New Chat
            </div>
            <div class="menu-item submenu-item" id="clearCurrentChat">
                <i class="fas fa-eraser"></i>
                Clear Current Chat
            </div>
            <div class="menu-item submenu-item" id="clearHistory">
                <i class="fas fa-trash"></i>
                Clear All History
            </div>
            <div class="menu-item submenu-item" id="clearEverything">
                <i class="fas fa-broom"></i>
                Clear Everything
            </div>
        </div>
        <div class="menu-divider"></div>
        <div class="menu-item" id="mcpServers">
            <i class="fas fa-server"></i>
            MCP Servers
        </div>
        <div class="menu-item" id="settings">
            <i class="fas fa-cog"></i>
            Settings
        </div>
    </div>

    <!-- Add Content Modal -->
    <div class="modal-overlay" id="addContentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Content</h3>
                <button class="modal-close" id="closeAddContent">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-tabs">
                    <div class="tab-header">
                        <button class="tab-btn active" data-tab="urlTab">URLs</button>
                        <button class="tab-btn" data-tab="filesTab">Files</button>
                        <button class="tab-btn" data-tab="imagesTab">Images</button>
                        <button class="tab-btn" data-tab="jsonTab">JSON</button>
                    </div>

                    <div class="tab-content active" id="urlTab">
                        <div class="form-group">
                            <label for="urlsInput">Enter URLs (one per line):</label>
                            <textarea id="urlsInput" placeholder="https://example.com/page1&#10;https://example.com/page2" rows="5"></textarea>
                        </div>
                    </div>

                    <div class="tab-content" id="filesTab">
                        <div class="form-group">
                            <label for="fileInput">Select files to upload:</label>
                            <div class="file-upload-area" id="fileUploadArea">
                                <input type="file" id="fileInput" multiple accept=".pdf,.docx,.txt,.md,.json,.csv" style="display: none;">
                                <div class="file-upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to select files or drag and drop</p>
                                    <p class="file-types">Supported: PDF, DOCX, TXT, MD, JSON, CSV</p>
                                </div>
                            </div>
                            <div class="file-list" id="fileList">
                                <!-- Selected files will be listed here -->
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="imagesTab">
                        <div class="form-group">
                            <label for="imageInput">Select images to upload:</label>
                            <div class="file-upload-area" id="imageUploadArea">
                                <input type="file" id="imageInput" multiple accept=".jpg,.jpeg,.png,.gif,.webp,.bmp,.heic,.heif" style="display: none;">
                                <div class="file-upload-placeholder">
                                    <i class="fas fa-images"></i>
                                    <p>Click to select images or drag and drop</p>
                                    <p class="file-types">Supported: JPG, PNG, GIF, WebP, BMP, HEIC</p>
                                </div>
                            </div>
                            <div class="file-list" id="imageList">
                                <!-- Selected images will be listed here with previews -->
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="jsonTab">
                        <div class="form-group">
                            <label for="jsonInput">Enter JSON data:</label>
                            <textarea id="jsonInput" placeholder='{"key": "value"}' rows="5"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="metadataInput">Metadata (optional):</label>
                            <textarea id="metadataInput" placeholder='{"source": "manual", "category": "example"}' rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAddContent">Cancel</button>
                <button class="btn btn-primary" id="submitAddContent">Add Content</button>
            </div>
        </div>
    </div>

    <!-- MCP Servers Modal -->
    <div class="modal-overlay" id="mcpServersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>MCP Servers Integration</h3>
                <button class="modal-close" id="closeMcpServers">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="mcp-servers-list" id="mcpServersList">
                    <!-- MCP servers will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMcpServers">Close</button>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h3 id="authModalTitle">Authenticate</h3>
                <button class="modal-close" id="closeAuth">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="authModalMessage">Authenticate with the selected MCP server.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAuth">Cancel</button>
                <button class="btn btn-primary" id="confirmAuth">OK</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="modal-close" id="closeSettings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <div class="settings-tab-header">
                        <button class="settings-tab-btn active" data-settings-tab="generalTab">
                            <i class="fas fa-sliders-h"></i> General
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="uiTab">
                            <i class="fas fa-desktop"></i> Interface
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="documentsTab">
                            <i class="fas fa-file-alt"></i> Documents
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="storageTab">
                            <i class="fas fa-database"></i> Storage
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="chatTab">
                            <i class="fas fa-comments"></i> Chat
                        </button>
                        <button class="settings-tab-btn" data-settings-tab="queryTab">
                            <i class="fas fa-search"></i> Query
                        </button>
                    </div>

                    <!-- General Settings Tab -->
                    <div class="settings-tab-content active" id="generalTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-info-circle"></i> Application Information</h4>
                            <div class="setting-item read-only">
                                <label>Application Name:</label>
                                <span id="appName">RAGme</span>
                            </div>
                            <div class="setting-item read-only">
                                <label>Version:</label>
                                <span id="appVersion">1.0.0</span>
                            </div>
                            <div class="setting-item read-only">
                                <label>Vector Database:</label>
                                <span id="settingsVectorDbType">-</span>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-sync-alt"></i> Auto-Refresh Settings</h4>
                            <div class="setting-item">
                                <label for="autoRefresh">
                                    <input type="checkbox" id="autoRefresh">
                                    Enable Auto-Refresh
                                </label>
                                <small>Automatically refresh document list and updates</small>
                            </div>
                            <div class="setting-item">
                                <label for="refreshInterval">Refresh Interval (seconds):</label>
                                <input type="number" id="refreshInterval" min="5" max="300">
                                <small>How often to refresh content (5-300 seconds)</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-eye"></i> Display Settings</h4>
                            <div class="setting-item">
                                <label for="showVectorDbInfo">
                                    <input type="checkbox" id="showVectorDbInfo">
                                    Show Vector DB Info
                                </label>
                                <small>Display vector database type and collections in header</small>
                            </div>
                            <div class="setting-item">
                                <label for="maxDocuments">Max Documents Display:</label>
                                <input type="range" id="maxDocuments" min="5" max="25" step="5">
                                <span class="range-value" id="maxDocumentsValue"></span>
                                <small>Maximum number of documents to display (5-25)</small>
                            </div>
                        </div>
                    </div>

                    <!-- Interface Settings Tab -->
                    <div class="settings-tab-content" id="uiTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-columns"></i> Layout Settings</h4>
                            <div class="setting-item">
                                <label for="documentListWidth">Document List Width (%):</label>
                                <input type="range" id="documentListWidth" min="20" max="60" step="5">
                                <span class="range-value" id="documentListWidthValue"></span>
                                <small>Width of the document list pane (20-60%)</small>
                            </div>
                            <div class="setting-item">
                                <label for="chatHistoryWidth">Chat History Width (%):</label>
                                <input type="range" id="chatHistoryWidth" min="5" max="30" step="5">
                                <span class="range-value" id="chatHistoryWidthValue"></span>
                                <small>Width of the chat history pane (5-30%)</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-toggle-on"></i> Panel Visibility</h4>
                            <div class="setting-item">
                                <label for="documentListCollapsed">
                                    <input type="checkbox" id="documentListCollapsed">
                                    Start with Document List Collapsed
                                </label>
                                <small>Begin with the document list panel hidden</small>
                            </div>
                            <div class="setting-item">
                                <label for="chatHistoryCollapsed">
                                    <input type="checkbox" id="chatHistoryCollapsed">
                                    Start with Chat History Collapsed
                                </label>
                                <small>Begin with the chat history panel hidden</small>
                            </div>
                            <div class="setting-item">
                                <label for="documentOverviewVisible">
                                    <input type="checkbox" id="documentOverviewVisible">
                                    Show Document Overview by Default
                                </label>
                                <small>Display the document overview visualization</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-chart-bar"></i> Visualization Settings</h4>
                            <div class="setting-item">
                                <label for="defaultVisualization">Default Visualization:</label>
                                <select id="defaultVisualization">
                                    <option value="graph">Network Graph</option>
                                    <option value="chart">Bar Chart</option>
                                    <option value="table">Table View</option>
                                </select>
                                <small>Default visualization type for document overview</small>
                            </div>
                            <div class="setting-item">
                                <label for="defaultDateFilter">Default Date Filter:</label>
                                <select id="defaultDateFilter">
                                    <option value="current">Current Week</option>
                                    <option value="month">Current Month</option>
                                    <option value="year">Current Year</option>
                                    <option value="all">All Time</option>
                                </select>
                                <small>Default date range for document filtering</small>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Settings Tab -->
                    <div class="settings-tab-content" id="documentsTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-file-upload"></i> Document Processing</h4>
                            <div class="setting-item">
                                <label for="documentOverviewEnabled">
                                    <input type="checkbox" id="documentOverviewEnabled">
                                    Enable Document Overview
                                </label>
                                <small>Show document overview and visualization features</small>
                            </div>
                            <div class="setting-item">
                                <label for="maxDisplayDocuments">Max Display Documents:</label>
                                <input type="range" id="maxDisplayDocuments" min="5" max="25" step="5">
                                <span class="range-value" id="maxDisplayDocumentsValue"></span>
                                <small>Maximum documents to display in lists (5-25)</small>
                            </div>
                            <div class="setting-item">
                                <label for="paginationSize">Pagination Size:</label>
                                <input type="range" id="paginationSize" min="5" max="25" step="5">
                                <span class="range-value" id="paginationSizeValue"></span>
                                <small>Number of documents per page (5-25)</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-search"></i> Search & Filtering</h4>
                            <div class="setting-item">
                                <label for="defaultContentFilter">Default Content Filter:</label>
                                <select id="defaultContentFilter">
                                    <option value="both">Documents & Images</option>
                                    <option value="documents">Documents Only</option>
                                    <option value="images">Images Only</option>
                                </select>
                                <small>Default content type filter</small>
                            </div>
                        </div>
                    </div>

                    <!-- Storage Settings Tab -->
                    <div class="settings-tab-content" id="storageTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-cloud-upload-alt"></i> File Storage Settings</h4>
                            <div class="setting-item">
                                <label for="copyUploadedDocs">
                                    <input type="checkbox" id="copyUploadedDocs">
                                    Copy Uploaded Documents to Storage
                                </label>
                                <small>Automatically copy uploaded documents to the storage service</small>
                            </div>
                            <div class="setting-item">
                                <label for="copyUploadedImages">
                                    <input type="checkbox" id="copyUploadedImages">
                                    Copy Uploaded Images to Storage
                                </label>
                                <small>Automatically copy uploaded images to the storage service</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-info-circle"></i> Storage Information</h4>
                            <div class="setting-item read-only">
                                <label>Storage Type:</label>
                                <span id="storageType">-</span>
                            </div>
                            <div class="setting-item read-only">
                                <label>Storage Bucket:</label>
                                <span id="storageBucket">-</span>
                            </div>
                            <div class="setting-item read-only">
                                <label>Storage Status:</label>
                                <span id="storageStatus">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Settings Tab -->
                    <div class="settings-tab-content" id="chatTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-robot"></i> AI Model Settings</h4>
                            <div class="setting-item">
                                <label for="maxTokens">Max Tokens:</label>
                                <input type="number" id="maxTokens" min="1000" max="16000">
                                <small>Maximum tokens for AI responses (1000-16000)</small>
                            </div>
                            <div class="setting-item">
                                <label for="temperature">Temperature:</label>
                                <input type="range" id="temperature" min="0" max="2" step="0.1">
                                <span class="range-value" id="temperatureValue"></span>
                                <small>AI response creativity (0=deterministic, 2=creative)</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-history"></i> Chat History</h4>
                            <div class="setting-item">
                                <label for="chatHistoryLimit">Chat History Limit:</label>
                                <input type="number" id="chatHistoryLimit" min="10" max="200">
                                <small>Maximum number of chat sessions to keep (10-200)</small>
                            </div>
                            <div class="setting-item">
                                <label for="autoSaveChats">
                                    <input type="checkbox" id="autoSaveChats">
                                    Auto-Save Chat Sessions
                                </label>
                                <small>Automatically save chat sessions to browser storage</small>
                            </div>
                        </div>
                    </div>

                    <!-- Query Settings Tab -->
                    <div class="settings-tab-content" id="queryTab">
                        <div class="settings-section">
                            <h4><i class="fas fa-search"></i> Search Configuration</h4>
                            <div class="setting-item">
                                <label for="topK">Top K Results:</label>
                                <input type="number" id="topK" min="1" max="20">
                                <small>Number of most relevant documents to retrieve for queries (1-20)</small>
                            </div>
                            <div class="setting-item">
                                <label for="textRerankTopK">Text Rerank Top K:</label>
                                <input type="number" id="textRerankTopK" min="1" max="10">
                                <small>Number of top text results to rerank for better relevance (1-10)</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-percentage"></i> Similarity Thresholds</h4>
                            <div class="setting-item">
                                <label for="textRelevanceThreshold">Text Relevance Threshold:</label>
                                <input type="range" id="textRelevanceThreshold" min="0.1" max="1.0" step="0.1">
                                <span class="range-value" id="textRelevanceThresholdValue"></span>
                                <small>Minimum similarity score for text documents (0.1-1.0). Higher values = more strict filtering.</small>
                            </div>
                            <div class="setting-item">
                                <label for="imageRelevanceThreshold">Image Relevance Threshold:</label>
                                <input type="range" id="imageRelevanceThreshold" min="0.1" max="1.0" step="0.1">
                                <span class="range-value" id="imageRelevanceThresholdValue"></span>
                                <small>Minimum similarity score for image documents (0.1-1.0). Higher values = more strict filtering.</small>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h4><i class="fas fa-lightbulb"></i> Recommendations</h4>
                            <div class="recommendations">
                                <div class="recommendation-item">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Text Threshold (0.8):</strong> Good balance between relevance and recall. Lower values (0.5-0.7) return more results but may be less relevant.
                                </div>
                                <div class="recommendation-item">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Image Threshold (0.8):</strong> Images typically need higher thresholds due to visual similarity challenges. Lower values (0.6-0.7) for broader image search.
                                </div>
                                <div class="recommendation-item">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Top K (5):</strong> Start with 5-10 results. Increase for comprehensive searches, decrease for focused results.
                                </div>
                                <div class="recommendation-item">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Text Rerank (3):</strong> Reranking improves relevance but adds processing time. Use 3-5 for optimal balance.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="resetSettings">
                    <i class="fas fa-undo"></i> Reset to Defaults
                </button>
                <button class="btn btn-secondary" id="cancelSettings">Cancel</button>
                <button class="btn btn-primary" id="saveSettings">
                    <i class="fas fa-save"></i> Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Document Details Modal -->
    <div class="modal-overlay" id="documentDetailsModal">
        <div class="modal-content document-details-modal">
            <div class="modal-header">
                <h3 id="documentDetailsTitle">Document Details</h3>
                <div class="modal-header-actions">
                    <button class="document-delete-btn" id="deleteDocumentFromDetails" title="Delete Document">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="modal-close" id="closeDocumentDetails">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body" id="documentDetailsBody">
                <!-- Document details will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeDocumentDetailsBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div class="modal-overlay" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Email</h3>
                <button class="modal-close" id="closeEmailModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="emailTo">To: <span style="color: red;">*</span></label>
                    <input type="email" id="emailTo" placeholder="recipient@example.com" required>
                </div>
                <div class="form-group">
                    <label for="emailSubject">Subject:</label>
                    <input type="text" id="emailSubject" readonly>
                </div>
                <div class="form-group">
                    <label for="emailBody">Message:</label>
                    <textarea id="emailBody" rows="10" readonly></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelEmail">Close</button>
                <button class="btn btn-primary" id="sendEmail">Send Email</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="app.js?v=1.2"></script>
</body>
</html>